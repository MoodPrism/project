pipeline {
	agent {docker {image 'maven:3.3.3'}}
	
    stages {
        stage('Build') {
	    steps {
               sh "mvn -f moodprism/pom.xml clean package"
            }
        }
        
        stage('Test') {
            steps {
	       sh "mvn -f moodprism/pom.xml test"
            }
        }
	stage('Deploy') {
	    steps {
		sh 'mvn -f moodprism/pom.xml deploy -s moodprism/settings.xml'
	    }
	}
	stage('Build Docker Image'){
	    steps{
		    dir('moodprism'){
		       sh 'docker image rm moodprism'
		       sh 'docker build -t moodprism .'
		       sh 'docker tag esp10-moodprism 192.168.160.99:5000/esp10-moodprism'
		       sh 'docker push 192.168.160.99:5000/esp10-moodprism'
		    }
	    }
	}
    }
}
